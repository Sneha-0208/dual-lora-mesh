#include <SPI.h>
#include <LoRa.h>

#define SS_PIN     10  // LoRa Chip Select
#define RST_PIN    9   // LoRa Reset
#define DIO0_PIN   2   // LoRa DIO0 (Interrupt pin)
#define LORA_FREQ  868E6  // 868 MHz (EU region)

void setup() {
  Serial.begin(9600);
  while (!Serial); // Wait for Serial monitor to open

  LoRa.setPins(SS_PIN, RST_PIN, DIO0_PIN);
  if (!LoRa.begin(LORA_FREQ)) {
    Serial.println("LoRa init failed. Check wiring.");
    while (true);  // Halt if LoRa initialization fails
  }

  LoRa.setSpreadingFactor(8);  // SF=8 for reception
  LoRa.enableCrc();            // Optional: Enable CRC check

  Serial.println("LoRa Receiver Ready at SF=8");
  Serial.println("Spreading Factor set to: SF=8");
}

void loop() {
  int packetSize = LoRa.parsePacket();

  if (packetSize > 0) {
    String receivedMessage = "";

    while (LoRa.available()) {
      receivedMessage += (char)LoRa.read();
    }

    Serial.print("Received: ");
    Serial.println(receivedMessage);
  }

  delay(5);  // Short delay to avoid flooding Serial and starving MCU
}
